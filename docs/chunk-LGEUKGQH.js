import{a as Se}from"./chunk-CCWZLCSZ.js";import{W as ge,_ as ue,s as me,t as ce,u as de,v as pe,w as he}from"./chunk-BUKZ4LC3.js";import{$ as le,Q as re,Z as oe,_ as se,ca as fe,o as ae}from"./chunk-QEJZE5DY.js";import{$ as a,Aa as y,Ba as Z,C as O,Da as R,Eb as W,F as X,G as A,Ga as F,Ha as U,K as E,L as j,O as Y,P as L,Pa as C,Qa as v,aa as H,c as k,da as u,fa as p,ga as l,gb as q,ha as m,hb as ee,ia as _,l as Q,lb as te,ma as P,oa as T,ob as ie,pa as h,qb as ne,r as M,ta as B,y as $,ya as c,za as S}from"./chunk-DKSOLQS5.js";import{a as z,b as K}from"./chunk-JCVLWF7J.js";var r=function(e){return e.Weapon="Weapon",e.WeaponCard="WeaponCard",e.LeftWeapon="LeftWeapon",e.LeftWeaponCard="LeftWeaponCard",e.Shield="Shield",e.ShieldCard="ShieldCard",e.HeadUpper="HeadUpper",e.HeadUpperCard="HeadUpperCard",e.HeadMiddle="HeadMiddle",e.HeadMiddleCard="HeadMiddleCard",e.HeadLower="HeadLower",e.Armor="Armor",e.ArmorCard="ArmorCard",e.Garment="Garment",e.GarmentCard="GarmentCard",e.Boot="Boot",e.BootCard="BootCard",e.AccLeft="AccLeft",e.AccLeftCard="AccLeftCard",e.AccRight="AccRight",e.AccRightCard="AccRightCard",e.CostumeEnchantUpper="CostumeEnchantUpper",e.CostumeEnchantMiddle="CostumeEnchantMiddle",e.CostumeEnchantLower="CostumeEnchantLower",e.CostumeEnchantGarment="CostumeEnchantGarment",e.ShadowWeapon="ShadowWeapon",e.ShadowShield="ShadowShield",e.ShadowArmor="ShadowArmor",e.ShadowBoot="ShadowBoot",e.ShadowEarring="ShadowEarring",e.ShadowPendant="ShadowPendant",e}(r||{});function ke(e,i){if(e&1&&(l(0,"div",16),_(1,"img",17),l(2,"div",18),c(3),m()()),e&2){let t=i.$implicit;a(1),B("src","assets/demo/images/jobs/icon_jobs_",t.icon,".png",L),a(2),S(t.label)}}function Me(e,i){if(e&1&&(l(0,"div",19)(1,"div",18),c(2),m(),l(3,"div",18),c(4),C(5,"number"),C(6,"number"),m()()),e&2){let t=i.$implicit;a(2),S(t.label),a(2),Z(" ( ",v(5,3,t.total)," accounts, ",v(6,5,t.totalPresets)," presets ) ")}}function Ee(e,i){if(e&1&&(l(0,"div",23),_(1,"img",24),l(2,"div",25),c(3),m()()),e&2){let t=h().$implicit;a(1),B("src","assets/demo/images/items/",t.id,".png",L),a(2),y(" ",t.name," ")}}function je(e,i){if(e&1&&(l(0,"div",20),u(1,Ee,4,2,"div",21),_(2,"div",22),m()),e&2){let t=i.$implicit,o=h();a(1),p("ngIf",o.selectedItemId),a(1),p("innerHTML",t.desc,Y)}}function Le(e,i){if(e&1){let t=P();l(0,"div")(1,"p-checkbox",32),T("ngModelChange",function(s){E(t);let n=h().$implicit,d=h();return j(d.isShowEnchant[n]=s)})("ngModelChange",function(){E(t);let s=h().$implicit,n=h();return j(n.onToggleShowEnchantClick(s))}),m()()}if(e&2){let t=h().$implicit,o=h();a(1),p("ngModel",o.isShowEnchant[t])("binary",!0)}}function Te(e,i){if(e&1&&(l(0,"div",40),_(1,"img",24),l(2,"div",25),c(3),m()()),e&2){let t=h(2).$implicit;a(1),B("src","assets/demo/images/items/",t.ItemId,".png",L),a(2),y(" ",t.ItemName," ")}}var be=function(){return{height:"8px"}},xe=function(e){return{width:e}};function Be(e,i){if(e&1&&(l(0,"div",35),u(1,Te,4,2,"div",36),l(2,"div",37)(3,"div",38),_(4,"div",39),m(),l(5,"span"),c(6),m()()()),e&2){let t=h().$implicit;a(1),p("ngIf",t.ItemId),a(2),p("ngStyle",F(10,be)),a(1),R("bg-",t.ColorStyle," h-full"),p("ngStyle",U(11,xe,t.Percentage+"%")),a(1),R("text-",t.ColorStyle," ml-2"),a(1),y("",t.Percentage," %")}}function Ne(e,i){if(e&1&&(l(0,"div"),_(1,"img",24),l(2,"div"),c(3),m()()),e&2){let t=i.$implicit,o=h(2).$implicit;R("flex gap-1 ",o.EnchantInfos.length===3?"item_enchant":"",""),a(1),B("src","assets/demo/images/items/",t.id,".png",L),a(2),S(t.name)}}function Oe(e,i){if(e&1&&(l(0,"div",41)(1,"div",42),u(2,Ne,4,5,"div",43),m(),l(3,"div",37)(4,"div",38),_(5,"div",44),m(),l(6,"span",45),c(7),m()()()),e&2){let t=h().$implicit;a(2),p("ngForOf",t.EnchantInfos),a(2),p("ngStyle",F(4,be)),a(1),p("ngStyle",U(5,xe,t.Percentage+"%")),a(2),y("",t.Percentage," %")}}function Ae(e,i){if(e&1&&(u(0,Be,7,13,"div",33),u(1,Oe,8,7,"div",34)),e&2){let t=i.$implicit;p("ngIf",!t.IsEnchant),a(1),p("ngIf",t.IsEnchant)}}function Re(e,i){if(e&1){let t=P();l(0,"div",26)(1,"div",27)(2,"div",28),c(3),m(),u(4,Le,2,2,"div",29),m(),l(5,"p-listbox",30),T("ngModelChange",function(s){E(t);let n=h();return j(n.selectedItemId=s)})("onChange",function(){E(t);let s=h();return j(s.onItemChange())}),u(6,Ae,2,2,"ng-template",31),m()()}if(e&2){let t=i.$implicit,o=h();p("hidden",!o.rankingMap[t].length),a(3),y(" ",t," "),a(1),p("ngIf",o.isItemHasEnchant[t]),a(1),p("options",o.rankingMap[t])("ngModel",o.selectedItemId)}}var _e=()=>Object.values(r).reduce((e,i)=>(e[i]=[],e),{}),Ce=e=>Object.values(r).reduce((i,t)=>(i[t]=e,i),{}),ye=(()=>{let i=class i{constructor(o,s){this.summaryService=o,this.roService=s,this.jobChangeSource=new k,this.jobChangeEvent$=this.jobChangeSource.asObservable(),this.skillChangeSource=new k,this.skillChangeEvent$=this.skillChangeSource.asObservable(),this.itemChangeSource=new k,this.itemChangeEvent$=this.itemChangeSource.asObservable(),this.toggleShowEnchantSource=new k,this.toggleShowEnchantEvent$=this.toggleShowEnchantSource.asObservable(),this.subscribtions=[],this.isLoading=!1,this.allItemPositions=Object.values(r),this.allClasses=ue(),this.allClasseMap=new Map(this.allClasses.map(n=>[n.value,n.label])),this.selectedJobId=this.allClasses[0].value,this.selectedJobName=this.allClasses[0].label,this.selectedSkillName="",this.itemMap={},this.jobSkillSummary={},this.presetSummary={},this.jobSummary={},this.totalSummary={},this.totalPresets=0,this.totalCurrentJobPresets=0,this.isShowEnchant=Ce(!0),this.isItemHasEnchant=Ce(!1),this.skillRankingList=[],this.rankingMap=_e()}ngOnInit(){this.loadData(),this.subscribeEvent()}ngOnDestroy(){for(let o of this.subscribtions)o.unsubscribe()}loadData(){Q([this.summaryService.getJobSkillSummary(),this.summaryService.getJobPresetSummary(),this.summaryService.getJobSummary(),this.summaryService.getTotalSummary(),this.roService.getItems()]).subscribe(([o,s,n,d,g])=>{this.jobSkillSummary=o,this.presetSummary=s,this.jobSummary=n,this.totalSummary=d,this.itemMap=g,this.totalPresets=Object.values(s).reduce((b,f)=>b+Object.values(f).reduce((J,x)=>J+x,0),0),this.setSkillRankingBySelection(),this.setRankingBySelection()})}subscribeEvent(){let o=this.jobChangeEvent$.pipe($(()=>this.isLoading=!0),M(100)).subscribe(()=>{this.setSkillRankingBySelection(),this.setRankingBySelection(),this.selectedJobName=this.allClasseMap.get(this.selectedJobId)||"",this.isLoading=!1}),s=this.skillChangeEvent$.pipe($(()=>this.isLoading=!0),M(100)).subscribe(()=>{this.setRankingBySelection(),this.isLoading=!1}),n=this.itemChangeEvent$.pipe(M(100)).subscribe(()=>{let g=`${this.selectedItemId}`.split("-").map(Number).filter(Boolean);this.displaySelectedItems=[...new Set(g)].map(b=>{let f=this.itemMap[b]||{};return{id:b,desc:ge(f.description),name:f.name}})}),d=this.toggleShowEnchantEvent$.pipe(M(100)).subscribe(g=>{this.setRankingBySelection(g)});this.subscribtions.push(o,s,n,d)}get itemRankingList(){return!this.selectedJobId||!this.selectedSkillName?_e():this.totalSummary[this.selectedJobId][this.selectedSkillName]}get totalAccounts(){return this.jobSummary[this.selectedJobId]||0}setSkillRankingBySelection(){let o=this.jobSkillSummary[this.selectedJobId]||{},s=[];for(let[n,d]of Object.entries(o))s.push({value:n,label:n,total:Number(d),totalPresets:this.presetSummary[this.selectedJobId]?.[n]||0});this.skillRankingList=s.sort((n,d)=>d.total-n.total),this.selectedSkillName=s[0]?.value,this.totalCurrentJobPresets=Object.values(this.presetSummary[this.selectedJobId]).reduce((n,d)=>n+d,0)}setRankingBySelection(o){for(let s of this.allItemPositions){if(o&&s!==o)continue;let n=[],d=!1;for(let g of this.itemRankingList[s]){let b=Math.ceil(g.UsingRate*100/this.jobSkillSummary[this.selectedJobId][this.selectedSkillName]);n.push(K(z({},g),{Percentage:b,ItemName:this.itemMap[g.ItemId]?.name,ColorStyle:this.getItemBarColorStyle(s),IsEnchant:!1,EnchantInfos:[]}));let f=Object.entries(g.Enchants);if(d||(f.length===0||f.length===1&&f[0][0]==="0-0-0"?d=!1:d=!0),this.isShowEnchant[s]===!1)continue;let J=f.sort(([x,I],[w,N])=>N-I).filter(([x,I],w)=>w<=4&&I>=.5);for(let[x,I]of J){let w=Math.floor(I*100/(g.TotalEnchant||1));if(w<=0)continue;let[N,V,G]=x.split("-").map(Number);if(N||V||G){let we=[N,V,G].filter(Number);n.push({ItemId:x,Enchants:{},UsingRate:0,ItemName:"",TotalAccount:0,TotalEnchant:0,TotalPreset:0,IsEnchant:!0,Percentage:w,ColorStyle:this.getItemBarColorStyle(s),EnchantInfos:we.map(D=>({id:D,name:this.itemMap[D]?.name}))})}}}this.isItemHasEnchant[s]=d,this.rankingMap[s]=n}}getItemBarColorStyle(o){switch(o){case r.Weapon:case r.WeaponCard:return"orange-500";case r.LeftWeapon:case r.LeftWeaponCard:return"orange-500";case r.Shield:case r.ShieldCard:return"pink-400";case r.HeadUpper:case r.HeadUpperCard:case r.HeadMiddle:case r.HeadMiddleCard:case r.HeadLower:return"blue-400";case r.Armor:case r.ArmorCard:case r.Garment:case r.GarmentCard:case r.Boot:case r.BootCard:return"red-500";case r.AccLeft:case r.AccLeftCard:case r.AccRight:case r.AccRightCard:return"teal-400";case r.CostumeEnchantUpper:case r.CostumeEnchantMiddle:case r.CostumeEnchantLower:case r.CostumeEnchantGarment:return"yellow-500";case r.ShadowWeapon:case r.ShadowShield:case r.ShadowArmor:case r.ShadowBoot:case r.ShadowEarring:case r.ShadowPendant:return"green-500";default:return"orange-500"}}onJobChange(){this.jobChangeSource.next(1)}onSkillChange(){this.skillChangeSource.next(1)}onItemChange(){this.itemChangeSource.next(1)}onToggleShowEnchantClick(o){this.toggleShowEnchantSource.next(o)}};i.\u0275fac=function(s){return new(s||i)(H(Se),H(fe))},i.\u0275cmp=X({type:i,selectors:[["app-preset-summary"]],decls:39,vars:21,consts:[[1,"grid","grid-nogutter",2,"min-width","1500px"],[1,"col-12","mb-2"],[1,"grid","grid-nogutter","column_list"],[3,"options","ngModel","disabled","ngModelChange","onChange"],["pTemplate","item","class","py-0"],[1,"col-12","grid","grid-nogutter"],[1,"col-3"],[1,"card","text-lg","m-0","p-2"],[1,"text-primary","text-lg"],[1,"mr-2","font-medium"],[1,"text-primary"],[1,"card","px-1","py-3","sticky","desc-sticky"],[1,"text-lg","font-bold","mb-3"],["class","mb-4",4,"ngFor","ngForOf"],[1,"col-9","grid","grid-nogutter"],["class","col-6 p-1",3,"hidden",4,"ngFor","ngForOf"],[1,"flex","gap-2","py-0"],["alt","",1,"job_img",3,"src"],[1,"text_ellips"],[1,"w-full","flex","justify-content-between"],[1,"mb-4"],["class","flex gap-1 mb-2",4,"ngIf"],[1,"px-2","py-2",2,"color","#000","background-color","#fff",3,"innerHTML"],[1,"flex","gap-1","mb-2"],["alt","",1,"item_img",3,"src"],[1,"text_ellips","font-medium"],[1,"col-6","p-1",3,"hidden"],[1,"card","m-0","p-2","flex","justify-content-around"],[1,"font-bold","text-lg"],[4,"ngIf"],["optionValue","ItemId",3,"options","ngModel","ngModelChange","onChange"],["pTemplate","item","styleClass","py-0 xxx"],["label","Show enchant",3,"ngModel","binary","ngModelChange"],["class","flex w-full justify-content-between",4,"ngIf"],["class","flex pl-4 w-full justify-content-between",4,"ngIf"],[1,"flex","w-full","justify-content-between"],["class","flex gap-1",4,"ngIf"],[1,"mt-2","md:mt-0","flex","align-items-center",2,"min-width","130px"],[1,"surface-300","border-round","overflow-hidden","w-10rem","lg:w-6rem",3,"ngStyle"],[3,"ngStyle"],[1,"flex","gap-1"],[1,"flex","pl-4","w-full","justify-content-between"],[1,"flex","gap-2","w-full"],[3,"class",4,"ngFor","ngForOf"],[1,"bg-yellow-300","h-full",3,"ngStyle"],[1,"text-yellow-300","ml-2"]],template:function(s,n){s&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"p-listbox",3),T("ngModelChange",function(g){return n.selectedJobId=g})("onChange",function(){return n.onJobChange()}),u(4,ke,4,2,"ng-template",4),m()()(),l(5,"div",5)(6,"div",6)(7,"div",7)(8,"div"),c(9,"Updated data: 25-04-2564"),m(),l(10,"div"),c(11," Total "),l(12,"span",8),c(13),C(14,"number"),m(),c(15," accounts, "),l(16,"span",8),c(17),C(18,"number"),m(),c(19," presets "),m(),l(20,"div")(21,"span",9),c(22),m(),l(23,"span",10),c(24),C(25,"number"),m(),c(26," accounts, "),l(27,"span",10),c(28),C(29,"number"),m(),c(30," presets "),m()(),l(31,"p-listbox",3),T("ngModelChange",function(g){return n.selectedSkillName=g})("onChange",function(){return n.onSkillChange()}),u(32,Me,7,7,"ng-template",4),m(),l(33,"div",11)(34,"div",12),c(35,"Item Description"),m(),u(36,je,3,2,"div",13),m()(),l(37,"div",14),u(38,Re,7,5,"div",15),m()()()),s&2&&(a(3),p("options",n.allClasses)("ngModel",n.selectedJobId)("disabled",n.isLoading),a(10),S(v(14,13,n.jobSummary[0])),a(4),S(v(18,15,n.totalPresets)),a(5),S(n.selectedJobName),a(2),S(v(25,17,n.totalAccounts)),a(4),S(v(29,19,n.totalCurrentJobPresets)),a(3),p("options",n.skillRankingList)("ngModel",n.selectedSkillName)("disabled",n.isLoading),a(5),p("ngForOf",n.displaySelectedItems),a(2),p("ngForOf",n.allItemPositions))},dependencies:[pe,ae,q,ee,te,oe,se,ce,ie],styles:["[_nghost-%COMP%]     .column_list p-listbox .p-listbox-list{min-width:1480px;columns:10;padding:0}[_nghost-%COMP%]     .column_list .p-listbox-item{padding:.5rem}.job_img[_ngcontent-%COMP%]{height:fit-content}.desc-sticky[_ngcontent-%COMP%]{top:40px;height:100vh}.item_img[_ngcontent-%COMP%]{height:fit-content}.item_enchant[_ngcontent-%COMP%]{width:33.33%}"]});let e=i;return e})();var Ie=(()=>{let i=class i{};i.\u0275fac=function(s){return new(s||i)},i.\u0275mod=A({type:i}),i.\u0275inj=O({imports:[W.forChild([{path:"",component:ye}]),W]});let e=i;return e})();var ht=(()=>{let i=class i{};i.\u0275fac=function(s){return new(s||i)},i.\u0275mod=A({type:i}),i.\u0275inj=O({imports:[Ie,he,re,ne,me,le,de]});let e=i;return e})();export{ht as PresetSummaryModule};
