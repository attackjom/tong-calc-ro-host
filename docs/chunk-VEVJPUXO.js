import{a as ve}from"./chunk-CCWZLCSZ.js";import{E as Se,K as _e,b as he,c as ge,d as ue,e as fe}from"./chunk-PHL3H7YD.js";import{E as ce,F as de,G as pe,I as Ce,o as le,z as me}from"./chunk-3WS4G3GU.js";import{$ as r,Aa as L,Ba as ne,C as B,Da as F,Eb as Q,F as ee,G as J,Ga as z,Ha as K,K as R,L as A,O as te,P,Pa as E,Qa as j,aa as G,c as N,da as _,fa as p,ga as l,gb as ie,ha as m,hb as ae,ia as y,l as q,lb as oe,ma as D,oa as H,ob as re,pa as g,qb as se,r as O,ta as $,y as V,ya as d,za as v}from"./chunk-DKSOLQS5.js";import{a as U,b as W}from"./chunk-JCVLWF7J.js";var s=function(e){return e.Weapon="Weapon",e.WeaponCard="WeaponCard",e.LeftWeapon="LeftWeapon",e.LeftWeaponCard="LeftWeaponCard",e.Shield="Shield",e.ShieldCard="ShieldCard",e.HeadUpper="HeadUpper",e.HeadUpperCard="HeadUpperCard",e.HeadMiddle="HeadMiddle",e.HeadMiddleCard="HeadMiddleCard",e.HeadLower="HeadLower",e.Armor="Armor",e.ArmorCard="ArmorCard",e.Garment="Garment",e.GarmentCard="GarmentCard",e.Boot="Boot",e.BootCard="BootCard",e.AccRight="AccRight",e.AccRightCard="AccRightCard",e.AccLeft="AccLeft",e.AccLeftCard="AccLeftCard",e.CostumeEnchantUpper="CostumeEnchantUpper",e.CostumeEnchantMiddle="CostumeEnchantMiddle",e.CostumeEnchantLower="CostumeEnchantLower",e.CostumeEnchantGarment="CostumeEnchantGarment",e.ShadowWeapon="ShadowWeapon",e.ShadowShield="ShadowShield",e.ShadowArmor="ShadowArmor",e.ShadowBoot="ShadowBoot",e.ShadowEarring="ShadowEarring",e.ShadowPendant="ShadowPendant",e}(s||{});function je(e,i){if(e&1&&(l(0,"div",16),y(1,"img",17),l(2,"div",18),d(3),m()()),e&2){let n=i.$implicit;r(1),$("src","assets/demo/images/jobs/icon_jobs_",n.icon,".png",P),r(2),v(n.label)}}function Te(e,i){if(e&1&&(l(0,"div",19)(1,"div",18),d(2),m(),l(3,"div",18),d(4),E(5,"number"),E(6,"number"),m()()),e&2){let n=i.$implicit;r(2),v(n.label),r(2),ne("( ",j(5,3,n.total)," accounts, ",j(6,5,n.totalPresets)," presets )")}}function Le(e,i){if(e&1&&(l(0,"div",23),y(1,"img",24),l(2,"div",25),d(3),m()()),e&2){let n=g().$implicit;r(1),$("src","assets/demo/images/items/",n.id,".png",P),r(2),L(" ",n.name," ")}}function Ne(e,i){if(e&1&&(l(0,"div",20),_(1,Le,4,2,"div",21),y(2,"div",22),m()),e&2){let n=i.$implicit,a=g();r(1),p("ngIf",a.selectedItemId),r(1),p("innerHTML",n.desc,te)}}function Oe(e,i){if(e&1){let n=D();l(0,"div")(1,"p-checkbox",32),H("ngModelChange",function(o){R(n);let t=g().$implicit,c=g();return A(c.isShowEnchant[t]=o)})("ngModelChange",function(){R(n);let o=g().$implicit,t=g();return A(t.onToggleShowEnchantClick(o))}),m()()}if(e&2){let n=g().$implicit,a=g();r(1),p("ngModel",a.isShowEnchant[n])("binary",!0)}}function Re(e,i){if(e&1&&(l(0,"div",40),y(1,"img",24),l(2,"div",25),d(3),m()()),e&2){let n=g(2).$implicit;r(1),$("src","assets/demo/images/items/",n.ItemId,".png",P),r(2),L(" ",n.ItemName," ")}}var Ie=function(){return{height:"8px"}},we=function(e){return{width:e}};function Ae(e,i){if(e&1&&(l(0,"div",35),_(1,Re,4,2,"div",36),l(2,"div",37)(3,"div",38),y(4,"div",39),m(),l(5,"span"),d(6),m()()()),e&2){let n=g().$implicit;r(1),p("ngIf",n.ItemId),r(2),p("ngStyle",z(10,Ie)),r(1),F("bg-",n.ColorStyle," h-full"),p("ngStyle",K(11,we,n.Percentage+"%")),r(1),F("text-",n.ColorStyle," ml-2"),r(1),L("",n.Percentage," %")}}function Pe(e,i){if(e&1&&(l(0,"div"),y(1,"img",24),l(2,"div"),d(3),m()()),e&2){let n=i.$implicit,a=g(2).$implicit;F("flex gap-1 ",a.EnchantInfos.length===3?"item_enchant":"",""),r(1),$("src","assets/demo/images/items/",n.id,".png",P),r(2),v(n.name)}}function He(e,i){if(e&1&&(l(0,"div",41)(1,"div",42),_(2,Pe,4,5,"div",43),m(),l(3,"div",37)(4,"div",38),y(5,"div",44),m(),l(6,"span",45),d(7),m()()()),e&2){let n=g().$implicit;r(2),p("ngForOf",n.EnchantInfos),r(2),p("ngStyle",z(4,Ie)),r(1),p("ngStyle",K(5,we,n.Percentage+"%")),r(2),L("",n.Percentage," %")}}function $e(e,i){if(e&1&&(_(0,Ae,7,13,"div",33),_(1,He,8,7,"div",34)),e&2){let n=i.$implicit;p("ngIf",!n.IsEnchant),r(1),p("ngIf",n.IsEnchant)}}function Be(e,i){if(e&1){let n=D();l(0,"div",26)(1,"div",27)(2,"div",28),d(3),m(),_(4,Oe,2,2,"div",29),m(),l(5,"p-listbox",30),H("ngModelChange",function(o){R(n);let t=g();return A(t.selectedItemId=o)})("onChange",function(){R(n);let o=g();return A(o.onItemChange())}),_(6,$e,2,2,"ng-template",31),m()()}if(e&2){let n=i.$implicit,a=g();p("hidden",!a.rankingMap[n].length),r(3),L(" ",n," "),r(1),p("ngIf",a.isItemHasEnchant[n]),r(1),p("options",a.rankingMap[n])("ngModel",a.selectedItemId)}}var be=()=>Object.values(s).reduce((e,i)=>(e[i]=[],e),{}),xe=e=>Object.values(s).reduce((i,n)=>(i[n]=e,i),{}),ke=(()=>{let i=class i{constructor(a,o){this.summaryService=a,this.roService=o,this.jobChangeSource=new N,this.jobChangeEvent$=this.jobChangeSource.asObservable(),this.skillChangeSource=new N,this.skillChangeEvent$=this.skillChangeSource.asObservable(),this.itemChangeSource=new N,this.itemChangeEvent$=this.itemChangeSource.asObservable(),this.toggleShowEnchantSource=new N,this.toggleShowEnchantEvent$=this.toggleShowEnchantSource.asObservable(),this.subscribtions=[],this.isLoading=!1,this.allItemPositions=Object.values(s),this.allClasses=_e(),this.allClasseMap=new Map(this.allClasses.map(t=>[t.value,t.label])),this.selectedJobId=this.allClasses[0].value,this.selectedJobName=this.allClasses[0].label,this.selectedSkillName="",this.itemMap={},this.jobSkillSummary={},this.presetSummary={},this.jobSummary={},this.totalSummary={},this.totalPresets=0,this.totalCurrentJobPresets=0,this.isShowEnchant=xe(!1),this.isItemHasEnchant=xe(!1),this.skillRankingList=[],this.rankingMap=be()}ngOnInit(){this.loadData(),this.subscribeEvent()}ngOnDestroy(){for(let a of this.subscribtions)a.unsubscribe()}loadData(){q([this.summaryService.getJobSkillSummary(),this.summaryService.getJobPresetSummary(),this.summaryService.getJobSummary(),this.summaryService.getTotalSummary(),this.roService.getItems()]).subscribe(([a,o,t,c,h])=>{this.jobSkillSummary=a,this.presetSummary=o,this.jobSummary=t,this.totalSummary=c,this.itemMap=h,this.totalPresets=Object.values(o).reduce((f,u)=>f+Object.values(u).reduce((b,S)=>b+S,0),0),this.setSkillRanking(),this.setItemRanking()})}subscribeEvent(){let a=this.jobChangeEvent$.pipe(V(()=>this.isLoading=!0),O(50)).subscribe(()=>{this.setSkillRanking(),this.setItemRanking(),this.selectedJobName=this.allClasseMap.get(this.selectedJobId)||"",this.isLoading=!1}),o=this.skillChangeEvent$.pipe(V(()=>this.isLoading=!0),O(50)).subscribe(()=>{this.setItemRanking(),this.isLoading=!1}),t=this.itemChangeEvent$.pipe(O(50)).subscribe(()=>{let h=`${this.selectedItemId}`.split("-").map(Number).filter(Boolean);this.displaySelectedItems=[...new Set(h)].map(f=>{let u=this.itemMap[f]||{};return{id:f,desc:Se(u.description),name:u.name}})}),c=this.toggleShowEnchantEvent$.pipe(O(50)).subscribe(h=>{this.setItemRanking(h)});this.subscribtions.push(a,o,t,c)}get itemRankingList(){return!this.selectedJobId||!this.selectedSkillName?be():this.totalSummary[this.selectedJobId][this.selectedSkillName]}get totalAccounts(){return this.jobSummary[this.selectedJobId]||0}setSkillRanking(){let a=this.jobSkillSummary[this.selectedJobId]||{},o=[];for(let[t,c]of Object.entries(a))o.push({value:t,label:t,total:Number(c),totalPresets:this.presetSummary[this.selectedJobId]?.[t]||0});this.skillRankingList=o.sort((t,c)=>c.total-t.total),this.selectedSkillName=o[0]?.value,this.totalCurrentJobPresets=Object.values(this.presetSummary[this.selectedJobId]).reduce((t,c)=>t+c,0)}setItemRanking(a){for(let o of this.allItemPositions){if(a&&o!==a)continue;let t=[],c=!1;for(let h of this.itemRankingList[o]){let f=Math.ceil(h.UsingRate*100/this.jobSkillSummary[this.selectedJobId][this.selectedSkillName]);t.push(W(U({},h),{Percentage:f,ItemName:this.itemMap[h.ItemId]?.name,ColorStyle:this.getItemBarColorStyle(o),IsEnchant:!1,EnchantInfos:[]}));let u=Object.entries(h.Enchants);if(c||(u.length===0||u.length===1&&u[0][0]==="0-0-0"?c=!1:c=!0),this.isShowEnchant[o]!==!0)continue;let b=u.sort(([S,I],[C,T])=>T-I).filter(([S,I],C)=>C<=4&&I>=.5);for(let[S,I]of b){let C=Math.floor(I*100/(h.TotalEnchant||1));if(C<=0)continue;let[T,w,x]=S.split("-").map(Number);if(T||w||x){let k=[T,w,x].filter(Number);t.push({ItemId:S,Enchants:{},UsingRate:0,ItemName:"",TotalAccount:0,TotalEnchant:0,TotalPreset:0,IsEnchant:!0,Percentage:C,ColorStyle:this.getItemBarColorStyle(o),EnchantInfos:k.map(M=>({id:M,name:this.itemMap[M]?.name}))})}}}this.isItemHasEnchant[o]=c,this.rankingMap[o]=t}}setItemRanking2(a){let o=this.jobSkillSummary[a]||{},t={};for(let[c]of Object.entries(o)){t[c]||(t[c]={});let h=this.totalSummary[a][c];for(let f of this.allItemPositions){let u=[],b=!1;for(let S of h[f]){let I=Math.ceil(S.UsingRate*100/this.jobSkillSummary[a][c]);u.push(W(U({},S),{Percentage:I,ItemName:this.itemMap[S.ItemId]?.name,ColorStyle:this.getItemBarColorStyle(f),IsEnchant:!1,EnchantInfos:[]}));let C=Object.entries(S.Enchants);if(b||(C.length===0||C.length===1&&C[0][0]==="0-0-0"?b=!1:b=!0),this.isShowEnchant[f]===!1)continue;let T=C.sort(([w,x],[k,M])=>M-x).filter(([w,x],k)=>k<=4&&x>=.5);for(let[w,x]of T){let k=Math.floor(x*100/(S.TotalEnchant||1));if(k<=0)continue;let[M,X,Y]=w.split("-").map(Number);if(M||X||Y){let Ee=[M,X,Y].filter(Number);u.push({ItemId:w,Enchants:{},UsingRate:0,ItemName:"",TotalAccount:0,TotalEnchant:0,TotalPreset:0,IsEnchant:!0,Percentage:k,ColorStyle:this.getItemBarColorStyle(f),EnchantInfos:Ee.map(Z=>({id:Z,name:this.itemMap[Z]?.name}))})}}}t[c][f]=u}}return t}getItemBarColorStyle(a){switch(a){case s.Weapon:case s.WeaponCard:return"orange-500";case s.LeftWeapon:case s.LeftWeaponCard:return"orange-500";case s.Shield:case s.ShieldCard:return"pink-400";case s.HeadUpper:case s.HeadUpperCard:case s.HeadMiddle:case s.HeadMiddleCard:case s.HeadLower:return"blue-400";case s.Armor:case s.ArmorCard:case s.Garment:case s.GarmentCard:case s.Boot:case s.BootCard:return"red-500";case s.AccLeft:case s.AccLeftCard:case s.AccRight:case s.AccRightCard:return"teal-400";case s.CostumeEnchantUpper:case s.CostumeEnchantMiddle:case s.CostumeEnchantLower:case s.CostumeEnchantGarment:return"yellow-500";case s.ShadowWeapon:case s.ShadowShield:case s.ShadowArmor:case s.ShadowBoot:case s.ShadowEarring:case s.ShadowPendant:return"green-500";default:return"orange-500"}}onJobChange(){this.jobChangeSource.next(1)}onSkillChange(){this.skillChangeSource.next(1)}onItemChange(){this.itemChangeSource.next(1)}onToggleShowEnchantClick(a){this.toggleShowEnchantSource.next(a)}};i.\u0275fac=function(o){return new(o||i)(G(ve),G(Ce))},i.\u0275cmp=ee({type:i,selectors:[["app-preset-summary"]],decls:39,vars:21,consts:[[1,"grid","grid-nogutter",2,"min-width","1500px"],[1,"col-12","mb-2"],[1,"grid","grid-nogutter","column_list"],[3,"options","ngModel","disabled","ngModelChange","onChange"],["pTemplate","item","class","py-0"],[1,"col-12","grid","grid-nogutter"],[1,"col-3"],[1,"card","text-lg","m-0","p-2"],[1,"text-primary","text-lg"],[1,"mr-2","font-medium"],[1,"text-primary"],[1,"card","px-1","py-3","sticky","desc-sticky"],[1,"text-lg","font-bold","mb-3"],["class","mb-4",4,"ngFor","ngForOf"],[1,"col-9","grid","grid-nogutter"],["class","col-6 p-1",3,"hidden",4,"ngFor","ngForOf"],[1,"flex","gap-2","py-0"],["alt","",1,"job_img",3,"src"],[1,"text_ellips"],[1,"w-full","flex","justify-content-between"],[1,"mb-4"],["class","flex gap-1 mb-2",4,"ngIf"],[1,"px-2","py-2",2,"color","#000","background-color","#fff",3,"innerHTML"],[1,"flex","gap-1","mb-2"],["alt","",1,"item_img",3,"src"],[1,"text_ellips","font-medium"],[1,"col-6","p-1",3,"hidden"],[1,"card","m-0","p-2","flex","justify-content-around"],[1,"font-bold","text-lg"],[4,"ngIf"],["optionValue","ItemId",3,"options","ngModel","ngModelChange","onChange"],["pTemplate","item","styleClass","py-0 xxx"],["label","Show enchant",3,"ngModel","binary","ngModelChange"],["class","flex w-full justify-content-between",4,"ngIf"],["class","flex pl-4 w-full justify-content-between",4,"ngIf"],[1,"flex","w-full","justify-content-between"],["class","flex gap-1",4,"ngIf"],[1,"mt-2","md:mt-0","flex","align-items-center",2,"min-width","130px"],[1,"surface-300","border-round","overflow-hidden","w-10rem","lg:w-6rem",3,"ngStyle"],[3,"ngStyle"],[1,"flex","gap-1"],[1,"flex","pl-4","w-full","justify-content-between"],[1,"flex","gap-2","w-full"],[3,"class",4,"ngFor","ngForOf"],[1,"bg-yellow-300","h-full",3,"ngStyle"],[1,"text-yellow-300","ml-2"]],template:function(o,t){o&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"p-listbox",3),H("ngModelChange",function(h){return t.selectedJobId=h})("onChange",function(){return t.onJobChange()}),_(4,je,4,2,"ng-template",4),m()()(),l(5,"div",5)(6,"div",6)(7,"div",7)(8,"div"),d(9,"Information date: 11-07-2567"),m(),l(10,"div"),d(11," Total "),l(12,"span",8),d(13),E(14,"number"),m(),d(15," accounts, "),l(16,"span",8),d(17),E(18,"number"),m(),d(19," presets "),m(),l(20,"div")(21,"span",9),d(22),m(),l(23,"span",10),d(24),E(25,"number"),m(),d(26," accounts, "),l(27,"span",10),d(28),E(29,"number"),m(),d(30," presets "),m()(),l(31,"p-listbox",3),H("ngModelChange",function(h){return t.selectedSkillName=h})("onChange",function(){return t.onSkillChange()}),_(32,Te,7,7,"ng-template",4),m(),l(33,"div",11)(34,"div",12),d(35,"Item Description"),m(),_(36,Ne,3,2,"div",13),m()(),l(37,"div",14),_(38,Be,7,5,"div",15),m()()()),o&2&&(r(3),p("options",t.allClasses)("ngModel",t.selectedJobId)("disabled",t.isLoading),r(10),v(j(14,13,t.jobSummary[0])),r(4),v(j(18,15,t.totalPresets)),r(5),v(t.selectedJobName),r(2),v(j(25,17,t.totalAccounts)),r(4),v(j(29,19,t.totalCurrentJobPresets)),r(3),p("options",t.skillRankingList)("ngModel",t.selectedSkillName)("disabled",t.isLoading),r(5),p("ngForOf",t.displaySelectedItems),r(2),p("ngForOf",t.allItemPositions))},dependencies:[ue,le,ie,ae,oe,ce,de,he,re],styles:["[_nghost-%COMP%]     .column_list p-listbox .p-listbox-list{min-width:1480px;columns:10;padding:0}[_nghost-%COMP%]     .column_list .p-listbox-item{padding:.5rem}.job_img[_ngcontent-%COMP%]{height:fit-content}.desc-sticky[_ngcontent-%COMP%]{top:40px;height:100vh;overflow:auto}.item_img[_ngcontent-%COMP%]{height:fit-content}.item_enchant[_ngcontent-%COMP%]{width:33.33%}"]});let e=i;return e})();var Me=(()=>{let i=class i{};i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=J({type:i}),i.\u0275inj=B({imports:[Q.forChild([{path:"",component:ke}]),Q]});let e=i;return e})();var ut=(()=>{let i=class i{};i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=J({type:i}),i.\u0275inj=B({imports:[Me,fe,me,se,pe,ge]});let e=i;return e})();export{ut as PresetSummaryModule};
